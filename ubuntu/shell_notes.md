Shell脚本的执行理解
=================

shell会按空格将内容划分进各个参数，之后依次分析运行这些参数：

- 如果一个参数不是命令，则解析运行它，发生错误则报错。比如 `a=1`，它不是个命令，但可正常解析运行，则正确执行不报错。
- 如果一个参数是命令，则 换行符或; 前的其余参数均作为传递给这一命令的参数，发生错误则报错。比如 `if [ $a == 1 ]`，[ 是个命令，之后的 $a、==、1、] 均作为参数传递给 [ 命令。

以上便是 `a=1` 中的=号两侧不能加空格，而 `if [ $a == 1 ]` 中的==号两侧必须加空格的原因。试执行并理解以下shell脚本：

```shell
a=1 expr 2 + 2
```

<br />



Shell脚本中[]、[[]]、$[]、()、$()、(())、$(())的区别
================================================

1、[]
-----

***等价于test命令***。用于关系运算符、布尔运算符、字符串运算符、文件测试运算符。

```shell
if [ $a -lt $b ]; then echo "$a 小于 $b"; fi;
```

如果只送一个参数进去，则是判断字符串长度是否为零（""，而非null）：

```shell
if [ $a ]; then echo "$a : 字符串不为空"; fi;
```

<br />


2、[[]]
-------

用于关系运算符、逻辑运算符。

```shell
if [[ $a < $b ]]; then echo "$a 小于 $b"; fi;
```

<br />


3、[] 与 [[]] 的关系与区别
------------------------

[[]] 是 [] 的拓展，两者都是条件表达式，返回true/false。  
[[]] 有比 [] 更高的容错性，有更多的功能（参见 <https://my.oschina.net/leejun2005/blog/368777#h2_7> 中的2.6条）；而 [] 则比 [[]] 有更好的兼容性，支持许多老版本的shell。  
只是想简单写个bash解释的shell脚本，用 [[]] 就好。

||关系运算符(-eq == -ne != -gt -lt -ge -le)、布尔运算符(! -a -o)|关系运算符(> <)、逻辑运算符(&& \|\|)|
|:---:|:---:|:---:|
|[]|√|乄（只有>、<加转义符“\”可以，其他的不行）|
|[[]]|乄（只有-a、-o不行，其他的都可以）|√|

<br />


4、$[]
------

$[] 是 $(()) 的过去形式，现在已不建议使用。

<br />


5、()
-----

() 中的所有语句将放入一个子shell中运行，你在子shell中所有的（非资源冲突）操作都不会影响到当前shell，当 () 内的语句执行成功，则返回true，否则返回false。  
其可以被用来做一些事情，比如 在不切换当前目录的情况下，在其它目录干点别的事。

```shell
(cd ~/Pictures; ls)
```

<br />


6、$()
------

与 () 差不多，$意味着返回值不再是true/false，而是返回这些语句的输出结果。***等价于``***。

```shell
echo $(cd ~/Pictures; ls) > ~/new.txt
```

<br />


7、() 与 $() 的关系与区别
----------------------

两者都是在子shell中执行语句，其唯一且最为重要的区别是：() 返回的是执行这些语句的成功与否true/false，而 $() 返回的是执行这些语句后的输出结果。

<br />


8、(())
-------

***等价于let命令***。进行整数算术运算（shell本身只支持整数运算，计算小数需使用 bc 这一外部计算器），然后返回true/false。

- (()) 中进行的运算不需要转义符“\”，使用变量也不需要“$”，形式与运算完全等同于c语言。
- 实际上，shell脚本用0表示true，用1表示false。所以结果为true/false时，实际返回的是0/1值。
- (()) 运算的结果非0 →（根据c语言规定）→ 则为true →（根据shell脚本规定）→ 返回0；  
  (()) 运算的结果为0 →（根据c语言规定）→ 则为false →（根据shell脚本规定）→ 返回1。

```shell
a=1; if ((a++)); then echo "$a"; fi;
```

<br />


9、$(())
--------

同样地，$意味着返回值不再是true/false，而是运算结果值。***等价于\`expr ...\`***。

```shell
a=10; b=$((a % 4)); echo "$b";
```

使用 $(()) 也要注意++、--运算符的位置：

```shell
a=1; b=$((a++)); echo "a 是 $a ，b 是 $b";  # a 是 2 ，b 是 1
a=1; b=$((++a)); echo "a 是 $a ，b 是 $b";  # a 是 2 ，b 是 2
```

<br />


10、(()) 与 $(()) 的关系与区别
---------------------------

两者都是进行整数算术运算，其最为重要的区别是：(()) 返回的是true/false，而 $(()) 返回的是运算结果值。  
如果想使用 (()) 完成整数的算术运算并得到结果值，赋值操作就要在 (()) 内进行：

```shell
a=1; ((b = a++)); echo "$b";  # 等价于 a=1; b=$((a++)); echo "$b";
```

(()) 只有部分shell支持，比如bash；而 $(()) 则被所有shell支持。想做整数算术运算嘛？请用 $(()) 。

<br />



Shell中进行数学计算的六种方式
=========================

<http://c.biancheng.net/view/1169.html>

<br />



Reference
=========

1、<https://my.oschina.net/leejun2005/blog/368777#h2_7>

2、<https://www.zhihu.com/question/266787434/answer/333007196>

3、<https://www.gnu.org/software/bash/manual/bash.html>

4、<http://c.biancheng.net/shell/>

<br />
